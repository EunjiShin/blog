# Note

## 왜 내가 하는 TDD는 실패하는가?

### TDD 실패의 배경
> Regression bug (회귀 버그) : 잘 돌아가던 기능이었으나, 기존 코드를 수정하면서 생긴 버그

- 회귀 버그로 인해 신규 기능의 배포가 더뎌지고, 인수 테스트에 너무 많은 리소스가 필요해진다.
- 테스트는 소프트웨어 내적 품질을 높이는 것이지, 사용자가 체감하는 외적 품질을 높이는 것은 아니다.
  - 따라서 테스트의 당위성을 위해 커버리지를 높이겠다는 가시적 목표를 두고 테스트를 도입하는 실수를 하게 된다.
- 단순 커버리지를 높이기 위해 사소한 코드에도 모두 테스트를 추가하다보면 아래의 문제가 생긴다.
  - 속도 저하, 비결정적 (실행할때마다 결과 달라짐), 뭘 하는 테스트인지 의미 파악 어려움

### 무엇이 문제일까?

1. 레거시 코드에 테스트를 넣는게 TDD가 아니다. 개념을 혼동하지 말자.
2. 레거시에 테스트를 넣으려면 코드 개선이 필요하다.
   - 테스트의 목적은 (1) 회귀 버그 방지 (2) 유연한 설계로 개선하는 것이다.
      - 유연한 설계로 개선할 때
        - 테스트를 쉽게 만들 수 있고
        - 테스트를 결정적이게 만들어준다.
     - 테스트를 짜기 어렵다면 외부 시스템에 너무 의존하고 있을 가능성이 있다. 모킹이 아니라 코드 구조를 수정할 필요가 있다.
     - 단, 시스템에 회귀 테스트가 없을 확률이 높기에 회귀 버그 발생 가능성이 높아진다.
3. 커버리지에 집착하면 안된다.
   - 테스트를 추가했을 때 얻을 수 있는 효용성을 고민해야지, 커버리지에 집착하면 테스트의 장점을 얻기 힘들다.
   - 정말 테스트가 필요한 코드인지 고민해보자.

## 결론

커버리지를 올리기 위한 mock 프레임워크 사용법만 고민하는 게 아니라, 테스트를 해야 하는 이유, 어떻게 테스트를 해야하는지에 대한 고민이 필요하다.

### 테스트와 확장성을 동시에 지닌 서비스의 성장 방식

- 소형자 > 중형차 > 대형차 ... 가 아니라, 기차 후미에 새로운 호차를 추가하는 구조를 만들어야 한다.
  - 새로운 호차는 테스트가 완료된 호차여야 한다.
- 즉, TDD를 논하기 이전에 테스트가 가능한 구조로 변경하는 것이 먼저다.

